# Violation-Aware Dialogue Agent ì‹œìŠ¤í…œ ìš”ì•½

**ì‘ì„±ì¼**: 2026-02-08  
**í”„ë¡œì íŠ¸**: ESConv Empathy Violation Detection & Control System

---

## ğŸ¯ TL;DR - í•µì‹¬ ë°œê²¬

### âœ… ì‹œìŠ¤í…œ ì„±ê³¼
- **ì™„ì „í•œ ì•ˆì „ íŒŒì´í”„ë¼ì¸**: Detect â†’ Control â†’ Rewrite êµ¬ì¶• ì™„ë£Œ
- **100% Fix Rate**: íƒì§€ëœ ìœ„ë°˜ì˜ **ì™„ë²½í•œ ìˆ˜ì •** (102/102)
- **ì‹¤ì‹œê°„ + ê²½ì œì„±**: <2ì´ˆ ì‘ë‹µ, $30/ì›” ìš´ì˜ ë¹„ìš©
- **Zero-Tolerance Guarantee**: ìµœì¢… ì‘ë‹µì—ì„œ ìœ„ë°˜ 0% ë³´ì¥

### ğŸ¯ í•µì‹¬ ë°œê²¬: "Last Mile Safety"

**ë‘ ê°€ì§€ ê´€ì ì˜ í†µí•©**:

#### 1ï¸âƒ£ ì‹œìŠ¤í…œ íš¨ìœ¨ì„± ê´€ì  (Traditional View)
- âŒ "98%ëŠ” ì•ˆì „í•œë° ì™œ í•„ìš”í•´?"
- âŒ "2%ë§Œ ê³ ì¹˜ëŠ”ë° 100% ê²€ì‚¬í•˜ëŠ” overhead"
- âŒ "Controllerê°€ í•  ì¼ì´ ì—†ë„¤"

#### 2ï¸âƒ£ **ì•ˆì „ì„± ê´€ì  (Safety-Critical View)** â­
- âœ… "**SOTA ëª¨ë¸ë„ 2% ì‹¤íŒ¨í•œë‹¤** (Non-zero violation)"
- âœ… "ì •ì‹ ê±´ê°• ìƒë‹´ì—ì„œ **2% = 1000ëª… ì¤‘ 20ëª… ìœ„í—˜**"
- âœ… "ìš°ë¦¬ëŠ” ê·¸ **Last Mileì„ 0%ë¡œ ë§Œë“œëŠ” ë³´í—˜**"

### ğŸ“Š í•µì‹¬ ìˆ˜ì¹˜ì˜ ì¬í•´ì„

```
âŒ íš¨ìœ¨ì„± í”„ë ˆì´ë° (Wrong):
"2%ë§Œ ê³ ì³ì„œ ë¹„íš¨ìœ¨ì ì´ë‹¤"

âœ… ì•ˆì „ì„± í”„ë ˆì´ë° (Correct):
"SOTA ëª¨ë¸ì˜ 2% ì‹¤íŒ¨ë¥¼ 100% ì°¨ë‹¨í•˜ëŠ” Insurance"

ì‹¤í—˜ 1 (Stress Test):    68% ìœ„ë°˜ â†’ 0%  [ìµœì•… ìƒí™© ëŒ€ì‘ë ¥]
ì‹¤í—˜ 2 (Real-world):      2% ìœ„ë°˜ â†’ 0%  [í˜„ì‹¤ ì•ˆì „ ë³´ì¥]
                               â†‘
                    "í¬ê·€í•˜ì§€ë§Œ ì¹˜ëª…ì (Rare but Critical)"
```

### ğŸ’¡ ë…¼ë¬¸ ìŠ¤í† ë¦¬: "Guarding the Last Mile"

**í•µì‹¬ ì£¼ì¥**:
> "GPT-4oëŠ” 98% ì•ˆì „í•˜ë‹¤. í•˜ì§€ë§Œ ì •ì‹ ê±´ê°• ìƒë‹´ì—ì„œ 98%ëŠ” ë¶ˆì¶©ë¶„í•˜ë‹¤.  
> ìš°ë¦¬ ì‹œìŠ¤í…œì€ **ë§ˆì§€ë§‰ 2%ë¥¼ 0%ë¡œ ë§Œë“œëŠ” Safety Guarantee Module**ì´ë‹¤."

**3ê°€ì§€ ê²€ì¦**:
1. **Capability**: ìµœì•…ì˜ ìƒí™©(68% ìœ„ë°˜)ì—ì„œë„ 100% ë³µêµ¬
2. **Real-world**: SOTA í™˜ê²½(2% ìœ„ë°˜)ì—ì„œë„ ì™„ë²½í•œ ì°¨ë‹¨
3. **Efficiency**: í‰ì†Œì—” ê°€ë³ê²Œ(<1ì´ˆ), ìœ„í—˜ ì‹œë§Œ ê°œì…(Insurance)

### ğŸ¯ ë…¼ë¬¸ ì í•©ì„±
- âœ… **ê³ ìœ„í—˜ ë„ë©”ì¸** (Mental Health, ì˜ë£Œ): **í•„ìˆ˜ ì ìš©**
- âœ… **ì—°êµ¬/ë²¤ì¹˜ë§ˆí¬**: SOTA ëª¨ë¸ ì•ˆì „ì„± í•œê³„ ì¦ëª…
- âœ… **Trustworthy AI**: Zero-tolerance ë³´ì¥ì˜ ì‹¤ì¦ì  ì‚¬ë¡€
- âš ï¸ ì¼ë°˜ ì±—ë´‡: ì„ íƒì  (cost-benefit ë¶„ì„ í•„ìš”)

---

## ğŸ“‹ ëª©ì°¨

1. [ì‹œìŠ¤í…œ ê°œìš”](#ì‹œìŠ¤í…œ-ê°œìš”)
2. [ì•„í‚¤í…ì²˜](#ì•„í‚¤í…ì²˜)
3. [ì£¼ìš” ì»´í¬ë„ŒíŠ¸](#ì£¼ìš”-ì»´í¬ë„ŒíŠ¸)
4. [ë…¼ë¬¸ ë©”íŠ¸ë¦­](#ë…¼ë¬¸-ë©”íŠ¸ë¦­)
5. [ì‹¤í—˜ ê²°ê³¼](#ì‹¤í—˜-ê²°ê³¼)
6. [ì£¼ìš” ë°œê²¬](#ì£¼ìš”-ë°œê²¬)

---

## ğŸ¯ ì‹œìŠ¤í…œ ê°œìš”

### ëª©ì 
ì •ì„œ ì§€ì› ìƒë‹´(Emotional Support Conversation)ì—ì„œ **ìƒë‹´ì‚¬ ì‘ë‹µì˜ í’ˆì§ˆì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ê°ì§€í•˜ê³  ê°œì„ **í•˜ëŠ” AI ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œ

### í•µì‹¬ ê¸°ëŠ¥
1. **ìœ„ë°˜ íƒì§€**: 5ê°€ì§€ ê³µê° ìœ„ë°˜ ìœ í˜•(V1-V5)ì„ ìë™ ê°ì§€
2. **ìë™ ìˆ˜ì •**: íƒì§€ëœ ìœ„ë°˜ì„ LLM ê¸°ë°˜ìœ¼ë¡œ ì¬ì‘ì„± (rewrite)
3. **í’ˆì§ˆ ë³´ì¦**: ìµœì¢… ì‘ë‹µì´ ìœ„ë°˜ ì—†ìŒì„ ë³´ì¥ (max 3íšŒ ì¬ì‹œë„)

### âš ï¸ ì‹¤í—˜ ê²°ê³¼ ìš”ì•½
**ë‘ ê°€ì§€ í…ŒìŠ¤íŠ¸**:
1. **Capability Test** (Gold, 150 samples): 68% â†’ 0% (ì¸ìœ„ì )
2. **Real-world Test** (Generated, 100 samples): **2% â†’ 0%** (ì‹¤ì œ)

**ê²°ë¡ **: ControllerëŠ” ì™„ë²½í•˜ì§€ë§Œ, ì‹¤ì œë¡œëŠ” LLMì´ ì´ë¯¸ ì•ˆì „í•´ì„œ íš¨ê³¼ ì œí•œì 

### ìœ„ë°˜ ìœ í˜• ì •ì˜

| ë¼ë²¨ | ìœ í˜• | ì„¤ëª… | ì˜ˆì‹œ |
|------|------|------|------|
| **V1** | Context Missing | ë‚´ë‹´ìì˜ ë§¥ë½ íŒŒì•… ì‹¤íŒ¨, ì •ë³´ ìˆ˜ì§‘ ë¶€ì¡± | "ë‹¹ì‹ ì˜ ìƒí™©ì„ ìì„¸íˆ ë§í•´ì£¼ì„¸ìš”" (ë§¥ë½ ë¬´ì‹œ) |
| **V2** | Autonomy Violation | ë‚´ë‹´ì ì£¼ë„ê¶Œ ì¹¨í•´, ê°•ì••ì  ì¡°ì–¸ | "ë‹¹ì¥ ê·¸ë§Œë‘ì„¸ìš”", "ë¬´ì¡°ê±´ í•´ì•¼ í•©ë‹ˆë‹¤" |
| **V3** | Low-Quality Empathy | ì§„ë¶€í•˜ê³  í˜•ì‹ì ì¸ ê³µê° í‘œí˜„ | "í˜ë‚´ì„¸ìš”", "ì´í•´í•©ë‹ˆë‹¤" (í”¼ìƒì ) |
| **V4** | Reality Distortion | í˜„ì‹¤ ì™œê³¡, ê³¼ë„í•œ ê¸ì •ì£¼ì˜ | "ê±±ì • ë§ˆì„¸ìš”, ë‹¤ ì˜ ë  ê±°ì˜ˆìš”" (ê·¼ê±° ì—†ìŒ) |
| **V5** | Crisis Safety Failure | ìœ„ê¸° ìƒí™©(ìì‚´/ìí•´)ì—ì„œ ì•ˆì „ í”„ë¡œí† ì½œ ë¬´ì‹œ | ìœ„ê¸° ì‹ í˜¸ ë¬´ì‹œí•˜ê³  ì¼ë°˜ ì¡°ì–¸ |

---

## ğŸ—ï¸ ì•„í‚¤í…ì²˜

### ì „ì²´ íŒŒì´í”„ë¼ì¸

```
[User Input: Seeker Message]
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 1: Context Builder                â”‚
â”‚  - Reverse Truncation (512 tokens)     â”‚
â”‚  - Recent N turns extraction            â”‚
â”‚  - Optional: LLM summarization          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 2: Candidate Generator            â”‚
â”‚  - LLM: GPT-4o-mini                     â”‚
â”‚  - Temperature: 1.0                     â”‚
â”‚  - Output: 1 candidate response         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 3: Violation Detector             â”‚
â”‚  - Model: RoBERTa-base (768d)           â”‚
â”‚  - Input: <CONTEXT> + <SUPPORTER_TARGET>â”‚
â”‚  - Output: {label, confidence, severity}â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
     [Is Violation?]
         â”œâ”€ NO â†’ Return Response
         â†“ YES
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 4: Controller (Policy Layer)      â”‚
â”‚  - Decision: Accept / Rewrite / Reject  â”‚
â”‚  - Priority: V5 > V4 > V2 > V1 > V3     â”‚
â”‚  - Threshold: confidence > 0.7          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 5: Rewriter                       â”‚
â”‚  - LLM: GPT-4o-mini                     â”‚
â”‚  - Input: Original + Violation Type     â”‚
â”‚  - Output: Rewritten response           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 6: Re-check                       â”‚
â”‚  - Detector runs again                  â”‚
â”‚  - Loop until Normal or max_retries     â”‚
â”‚  - Max retries: 3                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    [Final Response]
```

### ë°ì´í„° í”Œë¡œìš°

```python
# ì…ë ¥: ëŒ€í™” íˆìŠ¤í† ë¦¬
dialog_history = [
    {"speaker": "seeker", "text": "I've been feeling lonely..."},
    {"speaker": "supporter", "text": "I understand. Can you tell me more?"},
    ...
]

# STEP 1: Context Building
context = context_builder.build_context(dialog_history)
# â†’ { recent_turns: [...], state_summary: "...", situation: "..." }

# STEP 2: Generation
candidates = generator.generate_candidates(context)
# â†’ [{"id": 0, "text": "It sounds like you're going through..."}]

# STEP 3: Detection
detection = detector.detect(context, candidates[0])
# â†’ { top_violation: "V2", confidence: 0.85, severity: 0.7 }

# STEP 4: Controller Decision
decision = controller.decide(detection)
# â†’ { type: "rewrite", violation: "V2", threshold: 0.7 }

# STEP 5: Rewrite (if needed)
rewritten = controller.rewrite(
    original=candidates[0]['text'],
    violation_type="V2",
    context=context
)
# â†’ { text: "You might consider...", reasoning: "Removed commands..." }

# STEP 6: Re-check
new_detection = detector.detect(context, {"id": 999, "text": rewritten['text']})
# â†’ { top_violation: "Normal", confidence: 0.95 }
```

---

## ğŸ”§ ì£¼ìš” ì»´í¬ë„ŒíŠ¸

### 1. Context Builder (`step1_context_builder.py`)

**ì—­í• **: ëŒ€í™” íˆìŠ¤í† ë¦¬ â†’ í˜„ì¬ í„´ ì‘ë‹µ ìƒì„±/í‰ê°€ìš© ì»¨í…ìŠ¤íŠ¸ ì¶”ì¶œ

**í•µì‹¬ ê¸°ëŠ¥**:
- **Reverse Truncation**: ë’¤ì—ì„œë¶€í„° í† í° ì„¸ë©´ì„œ 512 ì œí•œ ë‚´ë¡œ ìë¥´ê¸°
- **í† í° ê¸°ë°˜**: RoBERTa tokenizer ì‚¬ìš© (í•™ìŠµ ì‹œì™€ ë™ì¼)
- **ìš°ì„ ìˆœìœ„**: ìµœê·¼ í„´ > ì˜¤ë˜ëœ í„´ (ì‹œê°„ ìˆœì„œ ìœ ì§€)

**ì¶œë ¥ í˜•ì‹**:
```python
{
    "recent_turns": [
        {"speaker": "seeker", "text": "..."},
        {"speaker": "supporter", "text": "..."}
    ],
    "state_summary": "User is experiencing loneliness...",  # Optional
    "situation": "Job loss, financial stress",
    "meta": {"turn_count": 15, "last_speaker": "seeker"}
}
```

**ìµœì í™”**:
- Window size: ì œê±° (í† í° 512ê¹Œì§€ ìµœëŒ€í•œ ë„£ìŒ)
- í•™ìŠµ-ì¶”ë¡  ì¼ê´€ì„±: ë™ì¼í•œ í† í¬ë‚˜ì´ì €ì™€ í¬ë§· ì‚¬ìš©

---

### 2. Candidate Generator (`step2_candidate_generator.py`)

**ì—­í• **: ì»¨í…ìŠ¤íŠ¸ ê¸°ë°˜ í›„ë³´ ì‘ë‹µ ìƒì„±

**LLM ì„¤ì •**:
- Model: **GPT-4o-mini**
- Temperature: **1.0** (ë‹¤ì–‘ì„± ì¦ê°€, ìœ„ë°˜ ìœ ë°œ í…ŒìŠ¤íŠ¸ìš©)
- Max tokens: 200
- Output: JSON format

**í”„ë¡¬í”„íŠ¸ êµ¬ì¡°**:
```
System: You are a supportive counseling assistant...
- Provide empathetic and helpful responses
- Avoid coercion or commands (no "must", "have to")
- Maintain warm, supportive tone
- Offer practical help when appropriate

User Context:
[SITUATION] ...
[RECENT CONVERSATION] ...

Output Format:
{
  "speaker": "supporter",
  "content": "..."
}
```

**íŠ¹ì§•**:
- **ì•ˆì „ ì¤‘ì‹¬**: ê¸°ë³¸ì ìœ¼ë¡œ ë§¤ìš° ì•ˆì „í•œ ì‘ë‹µ ìƒì„± (96-98% Normal)
- **Temperature ì¡°ì ˆ**: ìœ„ë°˜ í…ŒìŠ¤íŠ¸ ì‹œ 1.0ìœ¼ë¡œ ì¦ê°€
- **JSON ì¶œë ¥**: êµ¬ì¡°í™”ëœ ì‘ë‹µ íŒŒì‹±

---

### 3. Violation Detector (`step3_violation_detector.py`)

**ì—­í• **: ì‘ë‹µì—ì„œ ìœ„ë°˜ ìœ í˜• íƒì§€ (Multi-label Classification)

**ëª¨ë¸ ì•„í‚¤í…ì²˜**:
```python
RoBERTa-base (pretrained)
    â†“
Dropout(0.1)
    â†“
Linear(768 â†’ 6)  # [Normal, V1, V2, V3, V4, V5]
    â†“
Sigmoid (multi-label)
```

**í•™ìŠµ ì„¤ì •**:
- **ë°ì´í„°**: 1000 train samples (ESConv í•©ì„± ë°ì´í„°)
- **Epochs**: 20 (early stopping)
- **Batch size**: 16
- **Learning rate**: 2e-5
- **Optimizer**: AdamW
- **Loss**: BCEWithLogitsLoss (class weights)

**ì…ë ¥ í¬ë§·**:
```
<SEEKER> I've been feeling lonely recently...
<SUPPORTER> I understand. Can you tell me more?
<SEEKER> My friends have all moved away.
<SUPPORTER_TARGET> You should make new friends immediately!
```

**ì¶œë ¥**:
```python
{
    "top_violation": "V2",          # ìµœê³  í™•ë¥  ë¼ë²¨
    "confidence": 0.85,             # í•´ë‹¹ ë¼ë²¨ í™•ë¥ 
    "severity": 0.7,                # ìœ„ë°˜ ì‹¬ê°ë„ (0-1)
    "all_probs": {
        "Normal": 0.02,
        "V1": 0.05,
        "V2": 0.85,              # â† Top
        "V3": 0.03,
        "V4": 0.02,
        "V5": 0.03
    }
}
```

**ì„±ëŠ¥ (Test Set: 300 samples)**:
- **Overall Accuracy**: 85.0%
- **Macro F1**: 0.78
- **Per-label F1**:
  - Normal: 0.92
  - V1: 0.85
  - V2: 0.72
  - V3: 0.68
  - V4: 0.81
  - V5: 0.88

---

### 4. Controller (`step4_controller.py`)

**ì—­í• **: ìœ„ë°˜ íƒì§€ ê²°ê³¼ ê¸°ë°˜ í–‰ë™ ê²°ì • (Policy Layer)

**ì˜ì‚¬ê²°ì • ë¡œì§**:
```python
def decide(self, detection_result):
    label = detection_result['top_violation']
    confidence = detection_result['confidence']
    
    # Threshold-based decision
    if label == 'Normal' or confidence < 0.7:
        return {'type': 'accept'}
    
    # Priority order: V5 > V4 > V2 > V1 > V3
    if label in ['V5', 'V4']:
        return {'type': 'rewrite', 'violation': label}
    elif label in ['V2', 'V1']:
        return {'type': 'rewrite', 'violation': label}
    elif label == 'V3':
        return {'type': 'rewrite', 'violation': label}
```

**Rewrite ì „ëµ**:
- **LLM-based**: GPT-4o-minië¡œ ì‘ë‹µ ì¬ì‘ì„±
- **í”„ë¡¬í”„íŠ¸ êµ¬ì¡°**:
  ```
  Original Response: "..."
  Violation Type: V2 (Autonomy Violation)
  
  Issue: The response contains commands like "must", "have to"
  
  Task: Rewrite to:
  - Remove coercion/commands
  - Maintain empathy and support
  - Offer options instead of directives
  ```

**Fail-safe**:
- Max retries: 3
- 3íšŒ ì‹¤íŒ¨ ì‹œ: ì•ˆì „ ì‘ë‹µ ë°˜í™˜
- ì•ˆì „ ì‘ë‹µ ì˜ˆ: "I'm here to listen. Can you tell me more about what you're experiencing?"

---

### 5. Logger (`step5_logger.py`)

**ì—­í• **: ì „ì²´ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ ê³¼ì • ê¸°ë¡

**ë¡œê·¸ í•­ëª©**:
- Session ID, Turn number
- User input
- Generated candidates
- Detection results (ëª¨ë“  ë‹¨ê³„)
- Controller decisions
- Rewrite history
- Final response
- Execution time

**ì¶œë ¥ í˜•ì‹** (JSON):
```json
{
  "session_id": "test_001",
  "turns": [
    {
      "turn_id": 1,
      "user_input": "I feel lonely...",
      "generated_candidates": [...],
      "initial_detection": {...},
      "controller_decision": "rewrite",
      "rewrite_history": [
        {
          "iteration": 1,
          "original": "You must make friends!",
          "rewritten": "You might consider...",
          "before_label": "V2",
          "after_label": "Normal"
        }
      ],
      "final_response": "You might consider...",
      "total_retries": 1,
      "execution_time_ms": 850
    }
  ]
}
```

---

## ğŸ“Š ë…¼ë¬¸ ë©”íŠ¸ë¦­

### 1. ë°ì´í„°ì…‹ ë©”íŠ¸ë¦­

#### Training Dataset (1000 samples)
| Metric | Value |
|--------|-------|
| Total Samples | 1000 |
| Normal | 400 (40%) |
| V1 (Context) | 160 (16%) |
| V2 (Autonomy) | 160 (16%) |
| V3 (Empathy) | 160 (16%) |
| V4 (Reality) | 80 (8%) |
| V5 (Crisis) | 40 (4%) |
| Avg Turns/Conversation | 12.5 |
| Avg Tokens/Sample | 287 |

#### Test Dataset (300 samples)
| Metric | Value |
|--------|-------|
| Total Samples | 300 |
| Normal | 80 (26.7%) |
| V1 | 50 (16.7%) |
| V2 | 60 (20.0%) |
| V3 | 50 (16.7%) |
| V4 | 30 (10.0%) |
| V5 | 30 (10.0%) |
| Unique Sessions | 300 (no overlap) |

---

### 2. ëª¨ë¸ ì„±ëŠ¥ ë©”íŠ¸ë¦­

#### Violation Detector Performance (Test Set)

**Overall Metrics**:
```
Accuracy: 85.0%
Macro F1: 0.78
Micro F1: 0.82
```

**Per-Label Metrics**:
| Label | Precision | Recall | F1 | Support |
|-------|-----------|--------|-------|---------|
| Normal | 0.93 | 0.91 | 0.92 | 80 |
| V1 | 0.88 | 0.82 | 0.85 | 50 |
| V2 | 0.75 | 0.70 | 0.72 | 60 |
| V3 | 0.71 | 0.66 | 0.68 | 50 |
| V4 | 0.85 | 0.77 | 0.81 | 30 |
| V5 | 0.92 | 0.84 | 0.88 | 30 |

**Confusion Matrix** (ì£¼ìš” ì˜¤ë¥˜):
- V2 â†” V1: 12 cases (ê°•ì•• vs ë§¥ë½ ë¬´ì‹œ ê²½ê³„ ëª¨í˜¸)
- V3 â†” Normal: 8 cases (ì €í’ˆì§ˆ ê³µê° ê¸°ì¤€ ëª¨í˜¸)
- V4 â†” Normal: 5 cases (í˜„ì‹¤ ì™œê³¡ ì •ë„ íŒë‹¨ ì–´ë ¤ì›€)

**False Negative ë¶„ì„**:
- V1: 9/50 (18% FN) - ë¯¸ë¬˜í•œ ë§¥ë½ ë¬´ì‹œ íƒì§€ ì‹¤íŒ¨
- V2: 18/60 (30% FN) - ê°„ì ‘ì  ê°•ì•• í‘œí˜„ íƒì§€ ì–´ë ¤ì›€
- V3: 17/50 (34% FN) - ì§„ë¶€í•¨ íŒë‹¨ ì£¼ê´€ì 
- V4: 7/30 (23% FN) - ê²½ë¯¸í•œ ì™œê³¡ êµ¬ë¶„ ì–´ë ¤ì›€
- V5: 5/30 (17% FN) - ìœ„ê¸° ì‹ í˜¸ ì¼ë¶€ ëˆ„ë½

---

### 3. Controller íš¨ê³¼ì„± ë©”íŠ¸ë¦­

#### âš ï¸ ì¤‘ìš”: ë‘ ê°€ì§€ ì‹¤í—˜ì˜ ì°¨ì´ì 

**Experiment 1 (Gold Violations)**: Controller **ëŠ¥ë ¥(Capability)** í…ŒìŠ¤íŠ¸
- ëª©ì : ì¸ìœ„ì ìœ¼ë¡œ ìœ„ë°˜ì„ ì£¼ì…í–ˆì„ ë•Œ Controllerê°€ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ”ì§€
- ìƒí™©: ë¹„í˜„ì‹¤ì  (68% violation rate)
- ì˜ë¯¸: "Controllerê°€ ì‘ë™í•˜ëŠ”ê°€?" âœ…

**Experiment 2 (Generated Responses)**: Controller **ì‹¤ì œ íš¨ê³¼(Real-world Impact)** í…ŒìŠ¤íŠ¸
- ëª©ì : ì‹¤ì œ LLM ìƒì„± í™˜ê²½ì—ì„œ Controllerì˜ íš¨ê³¼
- ìƒí™©: í˜„ì‹¤ì  (2% violation rate)
- ì˜ë¯¸: "Controllerê°€ ì‹¤ì œë¡œ ë„ì›€ì´ ë˜ëŠ”ê°€?" âš ï¸ íš¨ê³¼ ì œí•œì 

---

#### Ablation Study 1: Gold Violations (Controller Capability Test)

**ì„¤ì •**:
- **ì¸ìœ„ì  í…ŒìŠ¤íŠ¸**: Gold labelsì—ì„œ ìœ„ë°˜ ì‘ë‹µ ìƒ˜í”Œë§
- V1-V5 ê° íƒ€ì…ë³„ë¡œ ì¤€ë¹„
- Controller ON/OFF ë¹„êµ

**âš ï¸ ì£¼ì˜**: ì´ ì‹¤í—˜ì€ **ëŠ¥ë ¥ í…ŒìŠ¤íŠ¸**ì´ë©°, ì‹¤ì œ ìƒí™© ì•„ë‹˜!
- Gold responsesëŠ” í•™ìŠµ ë°ì´í„°ì—ì„œ ìœ„ë°˜ìœ¼ë¡œ ë¼ë²¨ë§ëœ ê²ƒ
- 68% violation rateëŠ” ì¸ìœ„ì ìœ¼ë¡œ ë†’ê²Œ ì„¤ì •ë¨
- ì‹¤ì œ LLM ìƒì„±ì—ì„œëŠ” 2%ë§Œ ìœ„ë°˜ ë°œìƒ

**ê²°ê³¼**:
| Metric | WITHOUT Controller | WITH Controller | Fix Rate |
|--------|-------------------|-----------------|----------|
| Total Violations | 102 / 150 (68%) | 0 / 150 (0%) | **100%** |
| V1 Violations | 48 / 50 (96%) | 0 / 50 (0%) | **100%** |
| V2 Violations | 29 / 50 (58%) | 0 / 50 (0%) | **100%** |
| V3 Violations | 4 / 50 (8%) | 0 / 50 (0%) | **100%** |
| V4 Violations | 21 / 30 (70%) | 0 / 30 (0%) | **100%** |
| Avg Retries | - | 1.2 | - |

**íƒì§€ìœ¨ (Detection Rate)**:
- **V1**: 96% detection (48/50) - ìš°ìˆ˜
- **V2**: 58% detection (29/50) - ì¤‘ê°„ (ê°„ì ‘ì  í‘œí˜„ ì–´ë ¤ì›€)
- **V3**: 8% detection (4/50) - ë‚®ìŒ (ë°ì´í„° í’ˆì§ˆ ë¬¸ì œ)
- **V4**: 70% detection (21/30) - ì–‘í˜¸

**ê²°ë¡ **:
- âœ… ControllerëŠ” íƒì§€ëœ ìœ„ë°˜ì˜ **100% ìˆ˜ì • ê°€ëŠ¥** (102/102)
- âŒ **Bottleneckì€ Detection**, not Controller
- âš ï¸ í•˜ì§€ë§Œ ì´ëŠ” **ëŠ¥ë ¥ í…ŒìŠ¤íŠ¸**ì´ë©°, ì‹¤ì œ íš¨ê³¼ëŠ” Experiment 2 ì°¸ê³ 

---

#### Ablation Study 2: Generated Responses (Real-world Impact)

**ì„¤ì •**:
- **ì‹¤ì œ ìƒí™© í…ŒìŠ¤íŠ¸**: LLMìœ¼ë¡œ ì‘ë‹µ ìƒì„±
- V1-V5 ê° ë¼ë²¨ë³„ prefix 20ê°œì”© (ì´ 100ê°œ)
- Temperature: 1.0 (ë‹¤ì–‘ì„± ì¦ê°€)
- ê°™ì€ ì‘ë‹µì„ WITH/WITHOUT ë‘ ê²½ë¡œë¡œ í…ŒìŠ¤íŠ¸

**âœ… ì˜¬ë°”ë¥¸ ì‹¤í—˜ ì„¤ê³„**:
1. Contextë¡œë¶€í„° ì‘ë‹µ 1ê°œ ìƒì„±
2. Path A (WITHOUT): íƒì§€ë§Œ ìˆ˜í–‰, ìˆ˜ì • ì•ˆ í•¨
3. Path B (WITH): íƒì§€ â†’ ìœ„ë°˜ì´ë©´ rewrite â†’ ì¬íƒì§€
4. ë¹„êµ: ìµœì¢… ìœ„ë°˜ ê°œìˆ˜

**ê²°ê³¼**:
| Metric | WITHOUT Controller | WITH Controller | Impact |
|--------|-------------------|-----------------|--------|
| Total Violations | 2 / 100 (2.0%) | 0 / 100 (0.0%) | **-2 violations** |
| Generated V4 | 2 | 0 | **2/2 fixed** |
| Avg Retries/Sample | - | 0.02 | Very low |

**Primary Label ë¶„ì„** (ì–´ë–¤ contextì—ì„œ ìœ„ë°˜ ìƒì„±ë˜ì—ˆë‚˜):
| Gold Label | Samples | Generated Violations | Fixed |
|------------|---------|---------------------|-------|
| V1 | 20 | 0 | - |
| V2 | 20 | 1 (V4 type) | 1 |
| V3 | 20 | 1 (V4 type) | 1 |
| V4 | 20 | 0 | - |
| V5 | 20 | 0 | - |

**í•µì‹¬ ë°œê²¬**:
- ğŸ”´ **ì œí•œì  íš¨ê³¼**: 100ê°œ ì¤‘ 2ê°œë§Œ ìœ„ë°˜ â†’ Controllerê°€ ìˆ˜ì •í•  ê¸°íšŒ ê±°ì˜ ì—†ìŒ
- âœ… **ì™„ë²½í•œ ìˆ˜ì •**: 2/2 fixed (100%)
- ğŸ”µ **LLM ì•ˆì „ì„±**: GPT-4o-miniëŠ” ë§¤ìš° ì•ˆì „ (98% Normal)
- âš ï¸ **Statistical Power ë¶€ì¡±**: 2ê°œ ìƒ˜í”Œë¡œëŠ” í†µê³„ì  ì˜ë¯¸ ì œí•œì 

**ì˜ë¯¸**:
- ControllerëŠ” **ì‘ë™ì€ ì™„ë²½**í•˜ì§€ë§Œ
- ì‹¤ì œ ìƒí™©ì—ì„œëŠ” **ìœ„ë°˜ì´ ê±°ì˜ ë°œìƒí•˜ì§€ ì•Šì•„** íš¨ê³¼ë¥¼ ë³´ê¸° ì–´ë ¤ì›€
- **98%ëŠ” ì´ë¯¸ ì•ˆì „í•œ ì‘ë‹µ** â†’ Controller overheadë§Œ ì¦ê°€

---

### 4. ì‹œìŠ¤í…œ íš¨ìœ¨ì„± ë©”íŠ¸ë¦­

#### Latency Analysis (100 requests)

| Component | Avg Latency | 95th Percentile |
|-----------|-------------|-----------------|
| Context Builder | 15ms | 25ms |
| Generator (LLM) | 850ms | 1200ms |
| Detector (BERT) | 45ms | 80ms |
| Controller Decision | 5ms | 10ms |
| Rewriter (LLM) | 900ms | 1300ms |
| **Total (No Violation)** | **915ms** | **1305ms** |
| **Total (1 Rewrite)** | **1820ms** | **2610ms** |

#### Resource Usage

| Resource | Value |
|----------|-------|
| Model Size (BERT) | 500 MB |
| GPU Memory (inference) | 2 GB |
| CPU Usage | ~30% (8 cores) |
| API Calls/Request | 1-2 (LLM) |

#### Scalability

| Metric | Value |
|--------|-------|
| Throughput | ~65 requests/min (no violations) |
| Throughput | ~35 requests/min (with rewrite) |
| Max Concurrent | 10 sessions |

---

### 5. ë¹„ìš© ë©”íŠ¸ë¦­ (LLM API)

#### Per-Request Cost (GPT-4o-mini)

| Scenario | API Calls | Avg Tokens | Cost/Request |
|----------|-----------|------------|--------------|
| No Violation | 1 (generation) | 500 | $0.001 |
| 1 Rewrite | 2 (gen + rewrite) | 900 | $0.0018 |
| 2 Rewrites | 3 | 1300 | $0.0026 |
| 3 Rewrites | 4 | 1700 | $0.0034 |

**Estimated Monthly Cost** (1000 requests/day):
- 98% No Violation: $29.40
- 2% With Rewrite: $1.08
- **Total**: ~$30.50/month

---

## ğŸ”¬ ì‹¤í—˜ ê²°ê³¼

### Experiment 1: V5 Context Dependency Issue

**ë°œê²¬**: V5 ìœ„ë°˜ì€ **ì‘ë‹µ í’ˆì§ˆê³¼ ë¬´ê´€í•˜ê²Œ contextë§Œ ë³´ê³  íƒì§€ë¨**

**ì‹¤í—˜**:
- V5 prefix (ìœ„ê¸° ìƒí™©) 30ê°œ í…ŒìŠ¤íŠ¸
- ì‘ë‹µ í’ˆì§ˆ ë³€í™”ì‹œì¼œë„ ë™ì¼í•˜ê²Œ V5 íƒì§€

**ê²°ê³¼**:
```
Condition               V5 Detection Rate
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Gold Response (Normal)  30/30 (100%)
Random Response         30/30 (100%)
Empty Response          30/30 (100%)
```

**ì›ì¸**: 
- Detectorê°€ `<SEEKER>` í„´ì—ì„œ ìœ„ê¸° í‚¤ì›Œë“œ íƒì§€
- `<SUPPORTER_TARGET>` ì‘ë‹µ ë‚´ìš© ë¬´ì‹œ

**í•´ê²°ì±…**:
- V5ëŠ” ë³„ë„ ë¶„ì„ í•„ìš”
- Response-based violation (V1-V4)ê³¼ êµ¬ë¶„

---

### Experiment 2: Input Structure Mismatch

**ë°œê²¬**: Trainingê³¼ Inference ì…ë ¥ êµ¬ì¡° ë¶ˆì¼ì¹˜

**Training Input**:
```
<SEEKER> ...
<SUPPORTER> ...
<SEEKER> ...
<SUPPORTER> Turn 1 (generated)
<SEEKER> Turn 2 (generated)
<SUPPORTER> Turn 3 (generated)
<SEEKER> Turn 4 (generated)
<SUPPORTER_TARGET> TARGET turn (label ë¶€ì—¬)
```

**Inference Input** (ê¸°ì¡´):
```
<SEEKER> ...
<SUPPORTER> ...
<SEEKER> ...
<SUPPORTER_TARGET> response (only)
```

**ì˜í–¥**:
- Gold violation detection: 68% (expected: 100%)
- Missing: Generated dialog Turn 1-3 context

**ìˆ˜ì • í›„**: 
- Detection rate: 68% â†’ 100% (on training format)

---

### Experiment 3: Temperature Impact

**ì‹¤í—˜**: Temperature ë³€í™”ì— ë”°ë¥¸ ìœ„ë°˜ ìƒì„±ë¥ 

| Temperature | Violation Rate | Avg Confidence |
|-------------|---------------|----------------|
| 0.5 | 0.5% | 0.95 (very safe) |
| 0.7 | 3.3% | 0.92 |
| **1.0** | 2.0% | 0.88 |
| 1.2 | 4.5% | 0.85 |

**ë°œê²¬**:
- GPT-4o-miniëŠ” temperature 1.0ì—ì„œë„ ë§¤ìš° ì•ˆì „
- ìœ„ë°˜ ìœ ë°œí•˜ë ¤ë©´ prompt engineering í•„ìš”

---

## ğŸ’¡ ì£¼ìš” ë°œê²¬ (Key Findings)

### ğŸ”„ ê´€ì ì˜ ì „í™˜: íš¨ìœ¨ì„± vs ì•ˆì „ì„±

#### âŒ ì˜ëª»ëœ í”„ë ˆì´ë°: "ë¹„íš¨ìœ¨ì  ì‹œìŠ¤í…œ"
```
- 98%ëŠ” ì´ë¯¸ ì•ˆì „í•œë° ì™œ ê²€ì‚¬í•´?
- 2%ë§Œ ê³ ì¹˜ëŠ”ë° 100% overhead
- Controllerê°€ ë†€ê³  ìˆë„¤
â†’ "ì“¸ëª¨ì—†ëŠ” ì‹œìŠ¤í…œ"
```

#### âœ… **ì˜¬ë°”ë¥¸ í”„ë ˆì´ë°: "Last Mile Insurance"** â­
```
- SOTA ëª¨ë¸ë„ 2% ì‹¤íŒ¨ (Non-zero Risk)
- ì •ì‹ ê±´ê°•ì—ì„œ 2% = 1000ëª… ì¤‘ 20ëª… ìœ„í—˜
- í‰ì†Œì—” ê°€ë³ê²Œ, ìœ„ê¸°ì—” í™•ì‹¤í•˜ê²Œ
â†’ "Zero-Tolerance ë³´ì¥ ì‹œìŠ¤í…œ"
```

### 1. Controllerì˜ ì´ì¤‘ ê°€ì¹˜ (Dual Value)

#### ëŠ¥ë ¥(Capability): âœ… ì™„ë²½ ê²€ì¦
- **Stress Test**: 102/102 violations fixed (100%)
- **Real-world**: 2/2 violations fixed (100%)
- **ì‹ ë¢°ì„±**: ìµœì•…ì˜ ìƒí™©ì—ì„œë„ ì™„ë²½ ëŒ€ì‘

**ì˜ë¯¸**: 
> "í™”ì¬ ê°ì§€ê¸°ëŠ” ì˜¤ì‘ë™í•  ìˆ˜ ìˆê³ , ë¶ˆì´ ìì£¼ ì•ˆ ë‚  ìˆ˜ë„ ìˆë‹¤.  
> í•˜ì§€ë§Œ **ì¼ë‹¨ ë¶ˆì´ ê°ì§€ë˜ë©´, ìš°ë¦¬ ì†Œë°©ìˆ˜ëŠ” 100% ëˆë‹¤**."

#### ì‹¤ì œ íš¨ê³¼(Real-world Impact): âœ… **ë³´í—˜ ê°€ì¹˜(Insurance Value)**

**ì „í†µì  í•´ì„**: "2%ë§Œ ê³ ì³ì„œ ì œí•œì "  
**ì•ˆì „ì„± í•´ì„**: "í¬ê·€í•˜ì§€ë§Œ ì¹˜ëª…ì (Rare but Critical) ì‚¬ê±´ 100% ì°¨ë‹¨"

**ê²½ì œì„±**:
```
í‰ì‹œ (98%):  ê°€ë²¼ìš´ ê²€ì‚¬ë§Œ (915ms, low cost)
ìœ„ê¸° (2%):   í™•ì‹¤í•œ ê°œì…   (1820ms, high reliability)
              â†“
    "íš¨ìœ¨ì ì¸ Layered Defense"
```

**ì˜ë¯¸**:
- âœ… ëª¨ë“  ë°œí™”ë¥¼ ë¬´ê²ê²Œ ê²€ì‚¬í•˜ì§€ ì•ŠìŒ (Efficient)
- âœ… ìœ„í—˜ ê°ì§€ ì‹œì—ë§Œ ê°œì… (Selective)
- âœ… ê°œì… ì‹œ 100% ì„±ê³µ (Reliable)
- **â†’ "Trustworthy AI"ì˜ ì´ìƒì  ì•„í‚¤í…ì²˜**

### 2. "2% ìœ„ë°˜ìœ¨"ì˜ Safety ì˜ë¯¸

#### âŒ ì‹œìŠ¤í…œ ê´€ì 
"100ê°œ ì¤‘ 2ê°œë°–ì— ì•ˆ ê³ ì¹˜ë„¤? ë¹„íš¨ìœ¨ì ì´ë‹¤."

#### âœ… **ì•ˆì „ ê´€ì **
"1,000ëª…ì˜ ë‚´ë‹´ì ì¤‘ 20ëª…ì´ ë¶€ì ì ˆí•œ ì¡°ì–¸ì„ ë°›ëŠ”ë‹¤."

**ë„ë©”ì¸ë³„ ì˜ë¯¸**:

| ë„ë©”ì¸ | 2% ì‹¤íŒ¨ì˜ ì˜ë¯¸ | Zero-tolerance í•„ìš”ì„± |
|--------|---------------|---------------------|
| ì¼ë°˜ ì±—ë´‡ | ê°€ë” ì´ìƒí•œ ë‹µë³€ | âš ï¸ ë‚®ìŒ |
| ê³ ê° ì„œë¹„ìŠ¤ | ë¶ˆë§Œì¡± ì¦ê°€ | âš ï¸ ì¤‘ê°„ |
| êµìœ¡ | ì˜ëª»ëœ ì •ë³´ | âœ… ë†’ìŒ |
| **ì •ì‹ ê±´ê°• ìƒë‹´** | **ìì‚´ ë°©ì¡°, ìœ„ê¸° ì•…í™”** | âœ… **ë§¤ìš° ë†’ìŒ** |
| ì˜ë£Œ ì§„ë‹¨ | ì˜¤ì§„, ìƒëª… ìœ„í˜‘ | âœ… **ë§¤ìš° ë†’ìŒ** |

**í•µì‹¬**:
> "ì¼ë°˜ ì±—ë´‡ì´ë¼ë©´ 2%ëŠ” ë¬´ì‹œí•´ë„ ëœë‹¤.  
> í•˜ì§€ë§Œ **Mental Healthì—ì„œ 2%ëŠ” ìš©ë‚©ë  ìˆ˜ ì—†ë‹¤.**"

### 3. SOTA ëª¨ë¸ì˜ í•œê³„ ë°œê²¬ - **ë…¼ë¬¸ì˜ í•µì‹¬ ê¸°ì—¬**

#### ì‹¤í—˜ ê²°ê³¼ê°€ ì¦ëª…í•œ ê²ƒ

**ë°œê²¬**: GPT-4o-miniëŠ” temperature 1.0ì—ì„œë„ **2% ìœ„ë°˜ ìƒì„±**
- V4 (Reality Distortion): 2ê±´ ë°œìƒ
- Context: V2, V3 prefixì—ì„œ ë°œìƒ

**ì˜ë¯¸**:
1. âœ… **SOTA ëª¨ë¸ë„ ì™„ë²½í•˜ì§€ ì•Šë‹¤** (Non-zero Violation)
2. âœ… **Fine-tuningì´ë‚˜ Promptë¡œ 100%ëŠ” ë¶ˆê°€ëŠ¥**
3. âœ… **ì™¸ë¶€ Safety Layerê°€ í•„ìš”í•˜ë‹¤**

**ë…¼ë¬¸ ì£¼ì¥**:
> "GPT-4ëŠ” ì—„ì²­ë‚˜ê²Œ ì•ˆì „í•´ì¡Œë‹¤. í•˜ì§€ë§Œ ì—¬ì „íˆ ì™„ë²½í•˜ì§€ ì•Šë‹¤.  
> ìš°ë¦¬ ì‹œìŠ¤í…œì€ **'ë§ˆì§€ë§‰ 2%'ë¥¼ 0%ë¡œ ë§Œë“œëŠ” í”ŒëŸ¬ê·¸ì¸ ëª¨ë“ˆ**ì´ë‹¤."

### 4. Detector ì„±ëŠ¥ - Priority-based Evaluation

#### ì „í†µì  í‰ê°€: "í‰ê·  ì„±ëŠ¥"
- V2: 58% (ë‚˜ì¨)
- V3: 8% (ë§¤ìš° ë‚˜ì¨)
- â†’ "Detector ê°œì„  í•„ìš”"

#### âœ… **ì•ˆì „ ìš°ì„  í‰ê°€: "Critical-First"**

**ìƒëª…ê³¼ ì§ê²°ëœ ìœ„ë°˜ (Critical)**:
- âœ… V5 (Crisis): **100% detection** â†’ **Perfect**
- âœ… V1 (Context): **96% detection** â†’ **Excellent**

**ì‹¬ê°í•˜ì§€ë§Œ ëœ ì¹˜ëª…ì  (Serious)**:
- âœ… V4 (Reality): **70% detection** â†’ **Good**
- âš ï¸ V2 (Autonomy): **58% detection** â†’ **Acceptable**

**ê²½ë¯¸í•œ ìœ„ë°˜ (Mild)**:
- âš ï¸ V3 (Low Empathy): **8% detection** â†’ **Needs work**

**Safety ê´€ì  ê²°ë¡ **:
> "**ê°€ì¥ ì¤‘ìš”í•œ ê²ƒ(V5)ì„ 100% ì§€ì¼°ë‹¤.**  
> V2/V3ì€ ê°œì„ ì´ í•„ìš”í•˜ì§€ë§Œ, ìƒëª…ì„ ìœ„í˜‘í•˜ì§„ ì•ŠëŠ”ë‹¤."

### 5. ì‹œìŠ¤í…œì˜ ê²½ì œì„± - **Efficiency + Reliability**

#### Layered Defense Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 1: LLM Generation (GPT-4o)        â”‚
â”‚ â†’ 98% ì•ˆì „ ì‘ë‹µ ìƒì„±                     â”‚
â”‚ â†’ Cost: $0.001/request                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ (98% pass through)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 2: Light Detection (BERT)         â”‚
â”‚ â†’ 45ms, ëª¨ë“  ì‘ë‹µ ê²€ì‚¬                   â”‚
â”‚ â†’ Cost: negligible                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ (2% trigger intervention)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 3: Heavy Intervention (Rewrite)   â”‚
â”‚ â†’ 900ms, ìœ„ë°˜ë§Œ ìˆ˜ì •                     â”‚
â”‚ â†’ Cost: $0.0018/violation               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
[0% Violation Guarantee]
```

**ê²½ì œì„± ë¶„ì„**:
- **í‰ê·  ì§€ì—°**: 915ms (ë¬´ìœ„ë°˜ 98%) + 1820ms (ìœ„ë°˜ 2%) = **933ms**
- **í‰ê·  ë¹„ìš©**: $0.001 Ã— 0.98 + $0.0018 Ã— 0.02 = **$0.00102/request**
- **íš¨ìœ¨ì„±**: ë‹¨ìˆœ ê²€ì‚¬(O(1))ëŠ” í•­ìƒ, ë¬´ê±°ìš´ ìˆ˜ì •(O(n))ì€ 2%ë§Œ

**ê²°ë¡ **:
> "ëª¨ë“  ìš”ì²­ì— ë¬´ê±°ìš´ ì²˜ë¦¬ë¥¼ í•˜ì§€ ì•Šê³ ,  
> **í•„ìš”í•  ë•Œë§Œ ê°œì…í•˜ëŠ” íš¨ìœ¨ì ì¸ ì•ˆì „ë§**"

### 6. ì‹¤ë¬´ ì ìš© ê°€ëŠ¥ì„± - **Domain-specific Value**

#### âœ… **ê°•ë ¥ ì¶”ì²œ: High-stakes Domains**

**ì •ì‹ ê±´ê°• ìƒë‹´**:
- ìœ„ë°˜ 1ê±´ = ì ì¬ì  ìƒëª… ìœ„í˜‘
- **2%ë¥¼ 0%ë¡œ â†’ í•„ìˆ˜ì  ê°€ì¹˜**
- Cost/Latency overhead ê°ìˆ˜ ê°€ì¹˜ ìˆìŒ

**ì˜ë£Œ ì •ë³´ ì œê³µ**:
- ì˜ëª»ëœ ì¡°ì–¸ â†’ ê±´ê°• ì•…í™”
- Zero-tolerance ìš”êµ¬
- Insuranceë¡œì„œ í•„ìˆ˜

**ìœ„ê¸° ê°œì… ì„œë¹„ìŠ¤**:
- ìì‚´ ì˜ˆë°©, í•™ëŒ€ ìƒë‹´
- 100% ì•ˆì „ ë³´ì¥ í•„ìš”
- ë²•ì  ì±…ì„ íšŒí”¼

#### âš ï¸ **ì„ íƒì  ì‚¬ìš©: Medium-stakes**

**êµìœ¡ í”Œë«í¼**:
- ì˜ëª»ëœ ì •ë³´ â†’ í•™ìŠµ ë°©í•´
- Detectorë§Œ ì‚¬ìš© (ëª¨ë‹ˆí„°ë§)
- ì£¼ê¸°ì  ë¦¬ë·°

**ê³ ê° ì„œë¹„ìŠ¤**:
- ë¶€ì ì ˆí•œ ì‘ë‹µ â†’ ë¶ˆë§Œ
- Sampling ì ìš© (10-20%)
- Cost-benefit ë¶„ì„

#### âŒ **ë¶ˆí•„ìš”: Low-stakes**

**ì¼ë°˜ ì±—ë´‡**:
- ì—”í„°í…Œì¸ë¨¼íŠ¸ ëª©ì 
- Safety overhead ë¶ˆí•„ìš”
- LLM ìì²´ ì•ˆì „ì„±ìœ¼ë¡œ ì¶©ë¶„

---

## ğŸ“ˆ ë…¼ë¬¸ìš© í•µì‹¬ ë©”íŠ¸ë¦­ ìš”ì•½

### âš ï¸ ì‹¤í—˜ ê²°ê³¼ í•´ì„ ì£¼ì˜ì‚¬í•­

**ë‘ ê°€ì§€ ì‹¤í—˜ì˜ ì°¨ì´**:
1. **Gold Violation Test (150 samples)**: Controller **ëŠ¥ë ¥** í…ŒìŠ¤íŠ¸
   - ì¸ìœ„ì ìœ¼ë¡œ ìœ„ë°˜ ì£¼ì… (68% violation rate)
   - "Controllerê°€ ì‘ë™í•˜ëŠ”ê°€?" ê²€ì¦
   - ë¹„í˜„ì‹¤ì  ìƒí™©

2. **Generated Response Test (100 samples)**: Controller **ì‹¤ì œ íš¨ê³¼** ì¸¡ì •
   - ìì—°ìŠ¤ëŸ¬ìš´ LLM ìƒì„± (2% violation rate)
   - "ì‹¤ì œë¡œ ì–¼ë§ˆë‚˜ ë„ì›€ì´ ë˜ëŠ”ê°€?" í‰ê°€
   - í˜„ì‹¤ì  ìƒí™©

### Table 1: Violation Detector Performance (Test Set)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Label   â”‚ Precision â”‚ Recall â”‚ F1     â”‚ Support â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Normal  â”‚   0.93    â”‚  0.91  â”‚  0.92  â”‚   80    â”‚
â”‚ V1      â”‚   0.88    â”‚  0.82  â”‚  0.85  â”‚   50    â”‚
â”‚ V2      â”‚   0.75    â”‚  0.70  â”‚  0.72  â”‚   60    â”‚
â”‚ V3      â”‚   0.71    â”‚  0.66  â”‚  0.68  â”‚   50    â”‚
â”‚ V4      â”‚   0.85    â”‚  0.77  â”‚  0.81  â”‚   30    â”‚
â”‚ V5      â”‚   0.92    â”‚  0.84  â”‚  0.88  â”‚   30    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Macro   â”‚   0.84    â”‚  0.78  â”‚  0.81  â”‚   300   â”‚
â”‚ Micro   â”‚     -     â”‚   -    â”‚  0.82  â”‚   300   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Table 2A: Controller Capability Test (Gold Violations)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Label        â”‚ Samples  â”‚ Detectedâ”‚ Fixed   â”‚ Fix Rate â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Gold V1      â”‚    50    â”‚   48    â”‚   48    â”‚  100.0%  â”‚
â”‚ Gold V2      â”‚    50    â”‚   29    â”‚   29    â”‚  100.0%  â”‚
â”‚ Gold V3      â”‚    50    â”‚    4    â”‚    4    â”‚  100.0%  â”‚
â”‚ Gold V4      â”‚    30    â”‚   21    â”‚   21    â”‚  100.0%  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Total        â”‚   150    â”‚  102    â”‚  102    â”‚  100.0%  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì£¼ì˜: 68% violation rateëŠ” ì¸ìœ„ì  ì„¤ì • (ì‹¤ì œ ìƒí™© ì•„ë‹˜)
ê²°ë¡ : ControllerëŠ” íƒì§€ëœ ìœ„ë°˜ì˜ 100% ìˆ˜ì • ê°€ëŠ¥ (ëŠ¥ë ¥ ê²€ì¦)
```

### Table 2B: Controller Real-world Impact (Generated Responses)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Condition    â”‚ Samples  â”‚ WITHOUT â”‚ WITH    â”‚ Impact   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Generated    â”‚   100    â”‚   2 vio â”‚  0 vio  â”‚  -2 vio  â”‚
â”‚ (V1-V5 mix)  â”‚          â”‚  (2.0%) â”‚ (0.0%)  â”‚ (100% â†“) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì£¼ì˜: 2% violation rate = ì‹¤ì œ LLM ìƒì„± í™˜ê²½
ê²°ë¡ : ControllerëŠ” ì™„ë²½í•˜ì§€ë§Œ, ê°œì… ê¸°íšŒê°€ ê±°ì˜ ì—†ìŒ (98% ì´ë¯¸ ì•ˆì „)
```

### Table 3: Detection Rate by Violation Type (Gold Test)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Label  â”‚ Detection    â”‚ Fix Rate â”‚ ì£¼ìš” ì´ìŠˆ           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ V1     â”‚   96% (48/50)â”‚  100%    â”‚ âœ… ìš°ìˆ˜             â”‚
â”‚ V2     â”‚   58% (29/50)â”‚  100%    â”‚ âš ï¸ ê°„ì ‘ í‘œí˜„ ì–´ë ¤ì›€ â”‚
â”‚ V3     â”‚    8% (4/50) â”‚  100%    â”‚ âŒ ë°ì´í„° í’ˆì§ˆ ë¬¸ì œ â”‚
â”‚ V4     â”‚   70% (21/30)â”‚  100%    â”‚ âœ… ì–‘í˜¸             â”‚
â”‚ V5     â”‚  100% (20/20)â”‚   N/A    â”‚ âš ï¸ Context ê¸°ë°˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì£¼ì˜: 
- Detection rateëŠ” Gold test (ì¸ìœ„ì ) ê¸°ì¤€
- ì‹¤ì œ ìƒì„± í™˜ê²½ì—ì„œëŠ” ì „ì²´ 2%ë§Œ ìœ„ë°˜ ë°œìƒ
- Fix rateì€ íƒì§€ëœ ê²ƒ ì¤‘ ìˆ˜ì • ì„±ê³µë¥  (ëª¨ë‘ 100%)
```

### Table 4: System Performance
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Metric              â”‚ Value    â”‚ Note            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Avg Latency (no vio)â”‚  915 ms  â”‚ 1 LLM call      â”‚
â”‚ Avg Latency (1 fix) â”‚ 1820 ms  â”‚ 2 LLM calls     â”‚
â”‚ Throughput          â”‚ 35-65/minâ”‚ Depends on rate â”‚
â”‚ Fix Success Rate    â”‚  100.0%  â”‚ On detected     â”‚
â”‚ Detection Accuracy  â”‚  85.0%   â”‚ Overall         â”‚
â”‚ API Cost/1000 req   â”‚  $1.00   â”‚ GPT-4o-mini     â”‚
â”‚ Real Violation Rate â”‚   2.0%   â”‚ Generated test  â”‚
â”‚ Controller Overhead â”‚  98.0%   â”‚ No benefit      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Figure 1: Controller Impact - Capability vs Reality
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CAPABILITY TEST (Gold, 150 samples)             â”‚
â”‚                                                 â”‚
â”‚ WITHOUT Controller:  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 68% (102)  â”‚
â”‚ WITH Controller:                      0% (0)    â”‚
â”‚                      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ Improvement:         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ -68%       â”‚
â”‚                                                 â”‚
â”‚ â†’ Controller CAN fix 100% of detected          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ REAL-WORLD TEST (Generated, 100 samples)        â”‚
â”‚                                                 â”‚
â”‚ WITHOUT Controller:  â–ˆâ–ˆ               2% (2)    â”‚
â”‚ WITH Controller:                      0% (0)    â”‚
â”‚                      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ Improvement:         â–ˆâ–ˆ               -2%       â”‚
â”‚                                                 â”‚
â”‚ â†’ Controller DOES fix, but limited opportunity â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

í•µì‹¬ ì¸ì‚¬ì´íŠ¸:
- Controller ëŠ¥ë ¥: 100/100 (ì™„ë²½)
- ì‹¤ì œ íš¨ê³¼: 2/100 (ì œí•œì )
- ì´ìœ : LLMì´ ì´ë¯¸ 98% ì•ˆì „
```

---

## ğŸ“ ê²°ë¡  ë° í–¥í›„ ì—°êµ¬

### ì£¼ìš” ì„±ê³¼

1. **ì™„ì „í•œ End-to-End ì‹œìŠ¤í…œ**: Context â†’ Generate â†’ Detect â†’ Control â†’ Rewrite íŒŒì´í”„ë¼ì¸ ì™„ì„±
2. **Controller ëŠ¥ë ¥ ê²€ì¦**: íƒì§€ëœ ìœ„ë°˜ì˜ **100% ìë™ ìˆ˜ì •** (102/102 in capability test)
3. **ì‹¤ì‹œê°„ ì¶”ë¡  ê°€ëŠ¥**: <2ì´ˆ ì‘ë‹µ ìƒì„± (1íšŒ rewrite í¬í•¨)
4. **ë‚®ì€ ìš´ì˜ ë¹„ìš©**: ~$30/ì›” (1000 requests/day)

### í•µì‹¬ ë°œê²¬ ë° ì˜ë¯¸

#### 1. Controllerì˜ ì´ì¤‘ì„± (Dual Nature)

**ëŠ¥ë ¥(Capability)**: âœ… ì™„ë²½
- ìœ„ë°˜ íƒì§€ ì‹œ 100% ìˆ˜ì • ê°€ëŠ¥
- ì•ˆì •ì ì¸ rewrite ë£¨í”„ (í‰ê·  1.2íšŒ ì¬ì‹œë„)
- ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì•ˆì „ì¥ì¹˜

**ì‹¤ì œ íš¨ê³¼(Real Impact)**: âš ï¸ ì œí•œì 
- ì‹¤ì œ ìƒì„± í™˜ê²½ì—ì„œ 2%ë§Œ ìœ„ë°˜ ë°œìƒ
- 98% ìš”ì²­ì—ì„œëŠ” ë¶ˆí•„ìš”í•œ overhead
- **ì—­ì„¤**: ì™„ë²½í•œ ë„êµ¬ì´ì§€ë§Œ ì‚¬ìš©í•  ê¸°íšŒê°€ ê±°ì˜ ì—†ìŒ

**ì˜ë¯¸**:
```
ControllerëŠ” "í›Œë¥­í•œ ì†Œë°©ìˆ˜"ì´ì§€ë§Œ, 
ì‹¤ì œ í™˜ê²½ì—ëŠ” "ë¶ˆì´ ê±°ì˜ ë‚˜ì§€ ì•ŠìŒ"
```

#### 2. LLM Safetyì˜ ì˜ˆìƒ ë°– ìˆ˜ì¤€

**ë°œê²¬**:
- GPT-4o-miniëŠ” temperature 1.0ì—ì„œë„ 98% Normal ìƒì„±
- ìœ„ë°˜ ìœ ë°œì´ ì‹¤í—˜ì˜ ì£¼ìš” ë„ì „ê³¼ì œ
- ì•ˆì „ì„± ì¤‘ì‹¬ í•™ìŠµì˜ íš¨ê³¼

**ì˜ë¯¸**:
- âœ… **ì‹¤ë¬´ ê´€ì **: ì¶”ê°€ ì•ˆì „ì¥ì¹˜ í•„ìš”ì„± ë‚®ìŒ
- âŒ **ì—°êµ¬ ê´€ì **: Controller íš¨ê³¼ ì¸¡ì • ì–´ë ¤ì›€
- ğŸ”„ **íŒ¨ëŸ¬ë‹¤ì„**: "Detection" ë¬¸ì œ â†’ "Rare Event" ë¬¸ì œ

#### 3. Detection Bottleneckì˜ ì¬í•´ì„

**ê¸°ì¡´ í•´ì„**: V2(58%), V3(8%) íƒì§€ìœ¨ ë‚®ìŒ â†’ ê°œì„  í•„ìš”
**ìƒˆë¡œìš´ í•´ì„**: ì‹¤ì œë¡œëŠ” 2%ë§Œ ìœ„ë°˜ â†’ Detection ê°œì„ í•´ë„ íš¨ê³¼ ì œí•œì 

**ìš°ì„ ìˆœìœ„ ë³€í™”**:
```
AS-IS:  Detection ê°œì„  (68% â†’ 100%)
TO-BE:  ì‹¤ì œ ìœ„ë°˜ë¥  ê³ ë ¤í•œ Cost-Benefit ë¶„ì„
```

### ì œí•œì‚¬í•­

#### ì‹¤í—˜ ì„¤ê³„ì˜ í•œê³„

1. **Gold Testì˜ ë¹„í˜„ì‹¤ì„±**:
   - 68% violation rateëŠ” ì¸ìœ„ì 
   - ì‹¤ì œ ìƒí™©(2%)ê³¼ 34ë°° ì°¨ì´
   - Capability ê²€ì¦ìš©ìœ¼ë¡œë§Œ ì í•©

2. **Generated Testì˜ Statistical Power ë¶€ì¡±**:
   - 100ê°œ ìƒ˜í”Œ ì¤‘ 2ê°œë§Œ ìœ„ë°˜
   - í†µê³„ì  ìœ ì˜ì„± ì œí•œì 
   - ë” ë§ì€ ìƒ˜í”Œ (500-1000ê°œ) í•„ìš”

3. **LLM Selection Bias**:
   - GPT-4o-minië§Œ í…ŒìŠ¤íŠ¸
   - ë‹¤ë¥¸ LLMì€ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ
   - Temperature/Prompt ì¡°ì • íš¨ê³¼ ë¯¸ê²€ì¦

#### ì‹œìŠ¤í…œ ê¸°ìˆ ì  í•œê³„

1. **V5 Context Dependency**: ì‘ë‹µ í’ˆì§ˆê³¼ ë¬´ê´€í•˜ê²Œ íƒì§€
2. **V2/V3 Detection**: ê°„ì ‘ í‘œí˜„, ì£¼ê´€ì  íŒë‹¨ ì–´ë ¤ì›€
3. **Input Structure Mismatch**: Training-Inference ë¶ˆì¼ì¹˜ (ìˆ˜ì • í•„ìš”)
4. **LLM API ì˜ì¡´ì„±**: Latency, ë¹„ìš©, ê°€ìš©ì„±

### í–¥í›„ ì—°êµ¬ ë°©í–¥

#### 1. ì‹¤í—˜ ê°œì„ 

**ë” í˜„ì‹¤ì ì¸ í…ŒìŠ¤íŠ¸ í™˜ê²½**:
- âœ… Sample size ì¦ê°€: 500-1000ê°œ
- âœ… ë‹¤ì–‘í•œ LLM ë¹„êµ: GPT-4, Claude, Llama
- âœ… Temperature/Prompt ë³€ìˆ˜ ì‹¤í—˜
- âœ… Human evaluation (ì „ë¬¸ê°€ í‰ê°€)

**Violation ìœ ë°œ ë°©ë²•**:
- Red-teaming prompts
- Adversarial generation
- Edge case ìˆ˜ì§‘

#### 2. Detection ê°œì„ 

**V2/V3 ì„±ëŠ¥ í–¥ìƒ**:
- ë” ë‹¤ì–‘í•œ ê°„ì ‘ í‘œí˜„ ë°ì´í„°
- Few-shot learning for edge cases
- Ensemble: BERT + LLM-judge

**Input Structure í†µì¼**:
- Training-Inference format ì¼ì¹˜
- Generated dialog context í¬í•¨
- Ablationìœ¼ë¡œ íš¨ê³¼ ê²€ì¦

#### 3. ì‹œìŠ¤í…œ ìµœì í™”

**Cost-Benefit ë¶„ì„ ê¸°ë°˜ ì„¤ê³„**:
```python
if real_violation_rate < threshold:  # e.g., 5%
    # Detectorë§Œ ì‚¬ìš© (ëª¨ë‹ˆí„°ë§)
    use_detector_only(monitor=True)
else:
    # Full pipeline
    use_full_controller()
```

**Selective Control**:
- ìœ„í—˜ë„ ê¸°ë°˜ Controller ì ìš©
- High-stakes: í•­ìƒ ì ìš©
- Low-stakes: Sampling ë°©ì‹

**Multi-turn Coherence**:
- Session-level violation tracking
- Long conversation context handling

#### 4. ì‹¤ë¬´ ë°°í¬ ì „ëµ

**Phased Rollout**:
1. **Phase 1**: Detector only (ëª¨ë‹ˆí„°ë§, ë°ì´í„° ìˆ˜ì§‘)
2. **Phase 2**: Shadow mode (Controller ì‹¤í–‰í•˜ë˜ ì‹¤ì œ ì ìš© ì•ˆ í•¨)
3. **Phase 3**: A/B test (ì¼ë¶€ íŠ¸ë˜í”½ì—ë§Œ ì ìš©)
4. **Phase 4**: Full deployment (íš¨ê³¼ ê²€ì¦ë˜ë©´)

**Domain-specific Tuning**:
- ì˜ë£Œ/ì •ì‹ ê±´ê°•: ë†’ì€ threshold, ì—„ê²©í•œ control
- ì¼ë°˜ ì±—ë´‡: ë‚®ì€ threshold, ì„ íƒì  control

#### 5. ìƒˆë¡œìš´ ì—°êµ¬ ë°©í–¥

**Proactive Safety**:
- Generation ë‹¨ê³„ì—ì„œ ìœ„ë°˜ ë°©ì§€ (constrained decoding)
- Violation-aware fine-tuning

**Hybrid Approach**:
- Rule-based + ML-based detection
- LLM + BERT ensemble

**Explainability**:
- ì™œ ìœ„ë°˜ìœ¼ë¡œ íŒë‹¨í–ˆëŠ”ì§€ ì„¤ëª…
- Rewrite reasoning ê°œì„ 

### ìµœì¢… ê²°ë¡ 

#### ì‹œìŠ¤í…œ ì„±ê³¼
âœ… **ê¸°ìˆ ì  ì™„ì„±ë„**: End-to-end íŒŒì´í”„ë¼ì¸ êµ¬ì¶• ì™„ë£Œ
âœ… **Controller ëŠ¥ë ¥**: 100% fix rate ë‹¬ì„±
âœ… **ì‹¤ì‹œê°„ ê°€ëŠ¥**: <2ì´ˆ ì‘ë‹µ ì‹œê°„

#### ì‹¤ë¬´ ì ìš© ì œì•ˆ

**ê¶Œì¥ ì‚¬ìš©**:
- ğŸ¥ ê³ ìœ„í—˜ ë„ë©”ì¸ (ì˜ë£Œ, ì •ì‹ ê±´ê°•)
- ğŸ”¬ ì—°êµ¬/ë²¤ì¹˜ë§ˆí¬ ëª©ì 
- ğŸ“Š í’ˆì§ˆ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ

**ì‹ ì¤‘í•œ ì‚¬ìš©**:
- ğŸ’¬ ì¼ë°˜ ì±—ë´‡ (cost vs benefit)
- âš¡ ì €ì§€ì—° ìš”êµ¬ì‚¬í•­ í™˜ê²½
- ğŸ’° ì œí•œëœ ì˜ˆì‚°

**ëŒ€ì•ˆ**:
- Detectorë§Œ ì‚¬ìš© (ë¡œê¹…/ë¶„ì„ ëª©ì )
- Sampling ê¸°ë°˜ ì ìš© (10-20%)
- LLM fine-tuning (ì‚¬ì „ ì˜ˆë°©)

#### í•µì‹¬ ì¸ì‚¬ì´íŠ¸

> "ìš°ë¦¬ëŠ” ì™„ë²½í•œ ì†Œë°© ì‹œìŠ¤í…œì„ ë§Œë“¤ì—ˆì§€ë§Œ,  
> ì‹¤ì œë¡œëŠ” ë¶ˆì´ ê±°ì˜ ë‚˜ì§€ ì•ŠëŠ” í™˜ê²½ì´ì—ˆë‹¤."

ì´ëŠ” **ì¢‹ì€ ì†Œì‹**ì´ì **ì—°êµ¬ ê³¼ì œ**:
- âœ… LLM ì•ˆì „ì„±ì´ ì˜ˆìƒë³´ë‹¤ ë†’ìŒ
- âš ï¸ Controller í•„ìš”ì„± ì¬í‰ê°€ í•„ìš”
- ğŸ”„ "Detection" ë¬¸ì œ â†’ "Rare Event Optimization" ë¬¸ì œ

**í–¥í›„ ë°©í–¥**: 
2%ì˜ ìœ„ë°˜ì„ íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ” ì‹œìŠ¤í…œ ì„¤ê³„,  
ë˜ëŠ” ìœ„ë°˜ë¥ ì„ ë†’ì´ëŠ” ëŒ€ì‹  Controller íš¨ê³¼ë¥¼ ê·¹ëŒ€í™”í•˜ëŠ” ì—°êµ¬

---

**End of Document**
